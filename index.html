async function loadActiveLots() {
    try {
        const response = await fetch('https://makinmagic.github.io/SimNation/data/active-lots.json');
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        const activeLotsData = await response.json();
        
        // Create a mapping of lot IDs to lot names
        const lotMapping = {};
        const names = activeLotsData.names;
        const reservedLots = activeLotsData.reservedLots;

        reservedLots.forEach((id, index) => {
            lotMapping[id] = names[index]; // Map each ID to its corresponding name
        });

        return lotMapping; // Return the mapping
    } catch (error) {
        console.error('Failed to load active lots:', error);
        return {}; // Return an empty object on error
    }
}

async function loadOnlinePlayers() {
    try {
        const response = await fetch('https://makinmagic.github.io/SimNation/data/online-players.json');

        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }

        const onlineData = await response.json();

        if (!onlineData.avatars || onlineData.avatars.length === 0) {
            console.error('No avatars found in online data.');
            document.getElementById('players').innerHTML = 'No online players found.';
            return;
        }

        const playersContainer = document.getElementById('players');
        playersContainer.innerHTML = ''; // Clear previous content

        // Fetch active lots data and create a mapping
        const lotMapping = await loadActiveLots();

        let tableHtml = `
            <table>
                <thead>
                    <tr>
                        <th>Sim</th>
                        <th class="hidden">ID</th>
                        <th class="hidden">Location ID</th>
                        <th>Location</th>
                    </tr>
                </thead>
                <tbody>`;

        // Process online players
        onlineData.avatars.forEach(avatar => {
            const lotName = lotMapping[avatar.location] || 'Unknown'; // Get the lot name using the mapping
            tableHtml += `
                <tr>
                    <td>${avatar.name}</td>
                    <td class="hidden">${avatar.avatar_id}</td>
                    <td class="hidden">${avatar.location}</td>
                    <td>${lotName}</td>
                </tr>`;
        });

        tableHtml += `
                </tbody>
            </table>`;

        playersContainer.innerHTML = tableHtml; // Update the container with the table

    } catch (error) {
        console.error('Failed to load online players:', error);
        document.getElementById('players').innerHTML = 'Error loading online players.';
    }
}
